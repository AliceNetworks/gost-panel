import{ae as de,i as ie,af as ue,ag as re,ah as pe,ai as O,aj as ve,ak as fe,al as ye}from"./index-nVRnIEpk.js";import{u as me,f as ce,g,B as i,e as x}from"./naive-ui-Ba3Mczwr.js";import{k as ge,o as we,Z as Ce,Y as a,W as t,r as d,V as p,X as _e,j as u,N as r,a2 as K,c as ke,m as v}from"./vue-vendor-CGi32OHI.js";const be={class:"proxy-chains"},Ue=ge({__name:"ProxyChains",setup(he){const s=me(),V=ce(),P=d(!1),S=d(!1),U=d(!1),z=d(!1),B=d([]),w=d([]),j=d([]),y=d(!1),k=d(!1),C=d(!1),T=d(!1),H=d(""),_=d(null),m=d(null),q=[{label:"SOCKS5 代理",value:"socks5"},{label:"HTTP 代理",value:"http"},{label:"TCP 转发",value:"tcp"},{label:"UDP 转发",value:"udp"}],N=()=>({name:"",description:"",listen_addr:":1080",listen_type:"socks5",target_addr:"",enabled:!0}),o=d(N()),c=d({node_id:null}),E=ke(()=>{const l=new Set(w.value.map(e=>e.node_id));return j.value.filter(e=>!l.has(e.id)).map(e=>({label:`${e.name} (${e.host}:${e.port}) - ${e.protocol}`,value:e.id}))}),G=[{title:"ID",key:"id",width:60},{title:"名称",key:"name",width:150},{title:"描述",key:"description",ellipsis:{tooltip:!0}},{title:"监听",key:"listen_addr",width:100},{title:"类型",key:"listen_type",width:100,render:l=>v(x,{type:"info",size:"small"},()=>l.listen_type?.toUpperCase()||"SOCKS5")},{title:"状态",key:"enabled",width:80,render:l=>v(x,{type:l.enabled?"success":"default",size:"small"},()=>l.enabled?"启用":"禁用")},{title:"操作",key:"actions",width:280,render:l=>v(g,{size:"small"},()=>[v(i,{size:"small",onClick:()=>R(l)},()=>"编辑"),v(i,{size:"small",type:"primary",onClick:()=>Y(l)},()=>"跳点"),v(i,{size:"small",onClick:()=>le(l)},()=>"配置"),v(i,{size:"small",type:"error",onClick:()=>X(l)},()=>"删除")])}],I=[{title:"顺序",key:"hop_order",width:60,render:l=>l.hop_order+1},{title:"节点名称",key:"node.name",width:150,render:l=>l.node?.name||"-"},{title:"地址",key:"node.host",render:l=>l.node?`${l.node.host}:${l.node.port}`:"-"},{title:"协议",key:"node.protocol",width:100,render:l=>l.node?.protocol||"socks5"},{title:"状态",key:"node.status",width:80,render:l=>v(x,{type:l.node?.status==="online"?"success":"default",size:"small"},()=>l.node?.status==="online"?"在线":"离线")},{title:"启用",key:"enabled",width:80,render:l=>v(x,{type:l.enabled?"success":"default",size:"small"},()=>l.enabled?"是":"否")},{title:"操作",key:"actions",width:100,render:l=>v(i,{size:"small",type:"error",onClick:()=>ee(l)},()=>"移除")}],$=async()=>{P.value=!0;try{const l=await de();B.value=l||[]}catch{s.error("加载隧道列表失败")}finally{P.value=!1}},J=async()=>{try{const l=await ie();j.value=l||[]}catch(l){console.error("Failed to load nodes",l)}},L=()=>{o.value=N(),_.value=null,y.value=!0},R=l=>{_.value=l,o.value={...N(),...l},y.value=!0},W=async()=>{if(!o.value.name){s.error("请输入名称");return}if(!o.value.listen_addr){s.error("请输入监听地址");return}S.value=!0;try{_.value?(await ue(_.value.id,o.value),s.success("隧道已更新")):(await re(o.value),s.success("隧道已创建")),y.value=!1,$()}catch(l){s.error(l.response?.data?.error||"保存失败")}finally{S.value=!1}},X=l=>{V.warning({title:"删除隧道",content:`确定要删除隧道 "${l.name}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await fe(l.id),s.success("隧道已删除"),$()}catch{s.error("删除失败")}}})},Y=async l=>{m.value=l,k.value=!0,U.value=!0;try{const e=await O(l.id);w.value=e||[]}catch{s.error("加载跳点失败")}finally{U.value=!1}},Z=()=>{c.value={node_id:null},C.value=!0},Q=async()=>{if(!c.value.node_id){s.error("请选择节点");return}z.value=!0;try{await pe(m.value.id,{node_id:c.value.node_id,enabled:!0}),s.success("跳点已添加"),C.value=!1;const l=await O(m.value.id);w.value=l||[]}catch(l){s.error(l.response?.data?.error||"添加失败")}finally{z.value=!1}},ee=async l=>{V.warning({title:"移除跳点",content:`确定要移除节点 "${l.node?.name}" 吗？`,positiveText:"移除",negativeText:"取消",onPositiveClick:async()=>{try{await ye(m.value.id,l.id),s.success("跳点已移除");const e=await O(m.value.id);w.value=e||[]}catch{s.error("移除失败")}}})},le=async l=>{try{const e=await ve(l.id);H.value=typeof e=="string"?e:JSON.stringify(e,null,2),T.value=!0}catch{s.error("获取配置失败")}},ae=()=>{navigator.clipboard.writeText(H.value),s.success("已复制到剪贴板")};return we(()=>{$(),J()}),(l,e)=>{const M=p("n-alert"),A=p("n-data-table"),te=p("n-card"),b=p("n-input"),f=p("n-form-item"),D=p("n-select"),ne=p("n-switch"),F=p("n-form"),h=p("n-modal"),oe=p("n-code"),se=p("n-scrollbar");return _e(),Ce("div",be,[a(te,null,{header:t(()=>[a(r(g),{justify:"space-between",align:"center"},{default:t(()=>[e[15]||(e[15]=K("span",null,"隧道转发 / 代理链",-1)),a(r(i),{type:"primary",onClick:L},{default:t(()=>[...e[14]||(e[14]=[u(" 添加隧道 ",-1)])]),_:1})]),_:1})]),default:t(()=>[a(M,{type:"info",style:{"margin-bottom":"16px"}},{default:t(()=>[...e[16]||(e[16]=[u(" 隧道转发支持多跳代理链：用户 → 国内VPS(中转) → 国外VPS(落地) → 目标网站 ",-1)])]),_:1}),a(A,{columns:G,data:B.value,loading:P.value,"row-key":n=>n.id},null,8,["data","loading","row-key"])]),_:1}),a(h,{show:y.value,"onUpdate:show":e[7]||(e[7]=n=>y.value=n),preset:"dialog",title:_.value?"编辑隧道":"添加隧道",style:{width:"600px"}},{action:t(()=>[a(r(g),null,{default:t(()=>[a(r(i),{onClick:e[6]||(e[6]=n=>y.value=!1)},{default:t(()=>[...e[19]||(e[19]=[u("取消",-1)])]),_:1}),a(r(i),{type:"primary",loading:S.value,onClick:W},{default:t(()=>[...e[20]||(e[20]=[u("保存",-1)])]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(F,{model:o.value,"label-placement":"left","label-width":"100"},{default:t(()=>[a(f,{label:"名称",required:""},{default:t(()=>[a(b,{value:o.value.name,"onUpdate:value":e[0]||(e[0]=n=>o.value.name=n),placeholder:"例如: HK-US隧道"},null,8,["value"])]),_:1}),a(f,{label:"描述"},{default:t(()=>[a(b,{value:o.value.description,"onUpdate:value":e[1]||(e[1]=n=>o.value.description=n),placeholder:"隧道用途说明"},null,8,["value"])]),_:1}),a(f,{label:"监听地址",required:""},{default:t(()=>[a(b,{value:o.value.listen_addr,"onUpdate:value":e[2]||(e[2]=n=>o.value.listen_addr=n),placeholder:"例如: :1080"},{prefix:t(()=>[...e[17]||(e[17]=[u("本地端口",-1)])]),_:1},8,["value"])]),_:1}),a(f,{label:"监听类型"},{default:t(()=>[a(D,{value:o.value.listen_type,"onUpdate:value":e[3]||(e[3]=n=>o.value.listen_type=n),options:q},null,8,["value"])]),_:1}),a(f,{label:"目标地址"},{default:t(()=>[a(b,{value:o.value.target_addr,"onUpdate:value":e[4]||(e[4]=n=>o.value.target_addr=n),placeholder:"留空则使用代理模式，填写则为端口转发"},{prefix:t(()=>[...e[18]||(e[18]=[u("可选",-1)])]),_:1},8,["value"])]),_:1}),a(f,{label:"启用"},{default:t(()=>[a(ne,{value:o.value.enabled,"onUpdate:value":e[5]||(e[5]=n=>o.value.enabled=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),a(h,{show:k.value,"onUpdate:show":e[9]||(e[9]=n=>k.value=n),preset:"dialog",title:`管理跳点: ${m.value?.name}`,style:{width:"850px"}},{action:t(()=>[a(r(i),{onClick:e[8]||(e[8]=n=>k.value=!1)},{default:t(()=>[...e[24]||(e[24]=[u("关闭",-1)])]),_:1})]),default:t(()=>[a(r(g),{vertical:"",size:"large"},{default:t(()=>[a(M,{type:"info"},{default:t(()=>[...e[21]||(e[21]=[u(" 按顺序添加代理节点，流量将依次经过每个节点。例如：用户 → 节点1(国内中转) → 节点2(国外落地) → 目标 ",-1)])]),_:1}),a(r(g),{justify:"space-between",align:"center"},{default:t(()=>[e[23]||(e[23]=K("span",null,"跳点列表 (按顺序转发)",-1)),a(r(i),{type:"primary",size:"small",onClick:Z},{default:t(()=>[...e[22]||(e[22]=[u(" 添加跳点 ",-1)])]),_:1})]),_:1}),a(A,{columns:I,data:w.value,loading:U.value,"row-key":n=>n.id,size:"small","max-height":"400"},null,8,["data","loading","row-key"])]),_:1})]),_:1},8,["show","title"]),a(h,{show:C.value,"onUpdate:show":e[12]||(e[12]=n=>C.value=n),preset:"dialog",title:"添加跳点",style:{width:"500px"}},{action:t(()=>[a(r(g),null,{default:t(()=>[a(r(i),{onClick:e[11]||(e[11]=n=>C.value=!1)},{default:t(()=>[...e[25]||(e[25]=[u("取消",-1)])]),_:1}),a(r(i),{type:"primary",loading:z.value,onClick:Q},{default:t(()=>[...e[26]||(e[26]=[u("添加",-1)])]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(F,{model:c.value,"label-placement":"left","label-width":"100"},{default:t(()=>[a(f,{label:"选择节点"},{default:t(()=>[a(D,{value:c.value.node_id,"onUpdate:value":e[10]||(e[10]=n=>c.value.node_id=n),options:E.value,filterable:"",placeholder:"选择要添加的节点"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(h,{show:T.value,"onUpdate:show":e[13]||(e[13]=n=>T.value=n),preset:"dialog",title:"GOST 配置",style:{width:"750px"}},{action:t(()=>[a(r(i),{onClick:ae},{default:t(()=>[...e[28]||(e[28]=[u("复制配置",-1)])]),_:1})]),default:t(()=>[a(M,{type:"info",style:{"margin-bottom":"16px"}},{default:t(()=>[...e[27]||(e[27]=[u(" 将此配置保存到 GOST 配置文件即可启用多跳隧道转发 ",-1)])]),_:1}),a(se,{style:{"max-height":"400px"}},{default:t(()=>[a(oe,{code:H.value,language:"yaml","word-wrap":""},null,8,["code"])]),_:1})]),_:1},8,["show"])])}}});export{Ue as default};
