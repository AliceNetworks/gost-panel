import{k as y,X as a,Z as f,a2 as d,a7 as te,w as ce,o as ne,E as de,Y as e,W as n,N as x,j as b,U as P,F as pe,R as we,a3 as oe,r as k,V as s,a4 as E,a8 as me,n as fe,c as X,m as Y,a6 as ke}from"./vue-vendor-CGi32OHI.js";import{u as he}from"./user-CM8-BVvX.js";import{u as _e}from"./index-DI2hr4xE.js";import{c as ve,a as ye,d as ge,u as xe,e as Ce}from"./index-nVRnIEpk.js";import{S as Z,a as be,G as Me,L as Oe,P as Se}from"./SwapHorizontalOutline-CC6U-UAB.js";import{S as H,D as le,N as $e}from"./ServerOutline-CH8la6EY.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as je,N as J}from"./naive-ui-Ba3Mczwr.js";const Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Te=y({name:"HomeOutline",render:function(i,o){return a(),f("svg",Pe,o[0]||(o[0]=[d("path",{d:"M80 212v236a16 16 0 0 0 16 16h96V328a24 24 0 0 1 24-24h80a24 24 0 0 1 24 24v136h96a16 16 0 0 0 16-16V212",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),d("path",{d:"M480 256L266.89 52c-5-5.28-16.69-5.34-21.78 0L32 256",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),d("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 179V64h-48v69"},null,-1)]))}}),Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ze=y({name:"KeyOutline",render:function(i,o){return a(),f("svg",Le,o[0]||(o[0]=[d("path",{d:"M218.1 167.17c0 13 0 25.6 4.1 37.4c-43.1 50.6-156.9 184.3-167.5 194.5a20.17 20.17 0 0 0-6.7 15c0 8.5 5.2 16.7 9.6 21.3c6.6 6.9 34.8 33 40 28c15.4-15 18.5-19 24.8-25.2c9.5-9.3-1-28.3 2.3-36s6.8-9.2 12.5-10.4s15.8 2.9 23.7 3c8.3.1 12.8-3.4 19-9.2c5-4.6 8.6-8.9 8.7-15.6c.2-9-12.8-20.9-3.1-30.4s23.7 6.2 34 5s22.8-15.5 24.1-21.6s-11.7-21.8-9.7-30.7c.7-3 6.8-10 11.4-11s25 6.9 29.6 5.9c5.6-1.2 12.1-7.1 17.4-10.4c15.5 6.7 29.6 9.4 47.7 9.4c68.5 0 124-53.4 124-119.2S408.5 48 340 48s-121.9 53.37-121.9 119.17zM400 144a32 32 0 1 1-32-32a32 32 0 0 1 32 32z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ue=y({name:"ListOutline",render:function(i,o){return a(),f("svg",Be,o[0]||(o[0]=[te('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6)]))}}),Ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ne=y({name:"LogOutOutline",render:function(i,o){return a(),f("svg",Ee,o[0]||(o[0]=[d("path",{d:"M304 336v40a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V136a40 40 0 0 1 40-40h152c22.09 0 48 17.91 48 40v40",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),d("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 336l80-80l-80-80"},null,-1),d("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 256h256"},null,-1)]))}}),Ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ve=y({name:"MoonOutline",render:function(i,o){return a(),f("svg",Ie,o[0]||(o[0]=[d("path",{d:"M160 136c0-30.62 4.51-61.61 16-88C99.57 81.27 48 159.32 48 248c0 119.29 96.71 216 216 216c88.68 0 166.73-51.57 200-128c-26.39 11.49-57.38 16-88 16c-119.29 0-216-96.71-216-216z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ge=y({name:"PersonOutline",render:function(i,o){return a(),f("svg",qe,o[0]||(o[0]=[d("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),d("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ee=y({name:"SettingsOutline",render:function(i,o){return a(),f("svg",Ae,o[0]||(o[0]=[d("path",{d:"M262.29 192.31a64 64 0 1 0 57.4 57.4a64.13 64.13 0 0 0-57.4-57.4zM416.39 256a154.34 154.34 0 0 1-1.53 20.79l45.21 35.46a10.81 10.81 0 0 1 2.45 13.75l-42.77 74a10.81 10.81 0 0 1-13.14 4.59l-44.9-18.08a16.11 16.11 0 0 0-15.17 1.75A164.48 164.48 0 0 1 325 400.8a15.94 15.94 0 0 0-8.82 12.14l-6.73 47.89a11.08 11.08 0 0 1-10.68 9.17h-85.54a11.11 11.11 0 0 1-10.69-8.87l-6.72-47.82a16.07 16.07 0 0 0-9-12.22a155.3 155.3 0 0 1-21.46-12.57a16 16 0 0 0-15.11-1.71l-44.89 18.07a10.81 10.81 0 0 1-13.14-4.58l-42.77-74a10.8 10.8 0 0 1 2.45-13.75l38.21-30a16.05 16.05 0 0 0 6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 0 0-6.07-13.94l-38.19-30A10.81 10.81 0 0 1 49.48 186l42.77-74a10.81 10.81 0 0 1 13.14-4.59l44.9 18.08a16.11 16.11 0 0 0 15.17-1.75A164.48 164.48 0 0 1 187 111.2a15.94 15.94 0 0 0 8.82-12.14l6.73-47.89A11.08 11.08 0 0 1 213.23 42h85.54a11.11 11.11 0 0 1 10.69 8.87l6.72 47.82a16.07 16.07 0 0 0 9 12.22a155.3 155.3 0 0 1 21.46 12.57a16 16 0 0 0 15.11 1.71l44.89-18.07a10.81 10.81 0 0 1 13.14 4.58l42.77 74a10.8 10.8 0 0 1-2.45 13.75l-38.21 30a16.05 16.05 0 0 0-6.05 14.08c.33 4.14.55 8.3.55 12.47z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),De={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ke=y({name:"SunnyOutline",render:function(i,o){return a(),f("svg",De,o[0]||(o[0]=[te('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 48v48"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 416v48"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M403.08 108.92l-33.94 33.94"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M142.86 369.14l-33.94 33.94"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M464 256h-48"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M96 256H48"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M403.08 403.08l-33.94-33.94"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M142.86 142.86l-33.94-33.94"></path><circle cx="256" cy="256" r="80" fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32"></circle>',9)]))}}),He={class:"search-results"},Re={key:0,class:"empty-state"},Fe={key:1,class:"empty-state"},Qe=y({__name:"GlobalSearch",setup(g){const i=oe(),o=k(!1),v=k(""),h=k([]),M=k(!1),C=k(null);let _=null;const O=()=>{if(_&&clearTimeout(_),!v.value.trim()){h.value=[];return}_=setTimeout(async()=>{M.value=!0;try{const l=await ve(v.value);h.value=l}catch(l){console.error("Search failed",l),h.value=[]}finally{M.value=!1}},300)},T=l=>{switch(o.value=!1,v.value="",h.value=[],l.type){case"node":i.push({name:"nodes",query:{highlight:l.id}});break;case"client":i.push({name:"clients",query:{highlight:l.id}});break;case"user":i.push({name:"users",query:{highlight:l.id}});break}},L=l=>{switch(l){case"node":return H;case"client":return le;case"user":return Ge;default:return H}},z=l=>{switch(l){case"node":return"节点";case"client":return"客户端";case"user":return"用户";default:return l}},p=l=>{switch(l){case"node":return"#3b82f6";case"client":return"#22c55e";case"user":return"#f59e0b";default:return"#888"}},S=l=>{switch(l){case"node":return"info";case"client":return"success";case"user":return"warning";default:return"info"}},u=l=>{(l.ctrlKey||l.metaKey)&&l.key==="k"&&(l.preventDefault(),o.value=!0),l.key==="Escape"&&o.value&&(o.value=!1)};return ce(o,l=>{l?fe(()=>{C.value?.focus()}):(v.value="",h.value=[])}),ne(()=>{window.addEventListener("keydown",u)}),de(()=>{window.removeEventListener("keydown",u),_&&clearTimeout(_)}),(l,m)=>{const j=s("n-icon"),I=s("n-button"),V=s("n-input"),q=s("n-empty"),N=s("n-text"),G=s("n-tag"),A=s("n-thing"),D=s("n-list-item"),r=s("n-list"),t=s("n-spin"),K=s("n-modal");return a(),f("div",null,[e(I,{quaternary:"",onClick:m[0]||(m[0]=c=>o.value=!0)},{icon:n(()=>[e(j,null,{default:n(()=>[e(x(Z))]),_:1})]),default:n(()=>[m[3]||(m[3]=d("span",{class:"search-shortcut"},"Ctrl+K",-1))]),_:1}),e(K,{show:o.value,"onUpdate:show":m[2]||(m[2]=c=>o.value=c),preset:"card",style:{width:"600px","max-width":"90vw"},bordered:!1},{header:n(()=>[e(V,{ref_key:"searchInputRef",ref:C,value:v.value,"onUpdate:value":m[1]||(m[1]=c=>v.value=c),placeholder:"搜索节点、客户端、用户...",size:"large",clearable:"",onInput:O},{prefix:n(()=>[e(j,null,{default:n(()=>[e(x(Z))]),_:1})]),_:1},8,["value"])]),footer:n(()=>[e(N,{depth:"3",style:{"font-size":"12px"}},{default:n(()=>[...m[5]||(m[5]=[b(" 按 Enter 选择 · 按 Esc 关闭 ",-1)])]),_:1})]),default:n(()=>[d("div",He,[e(t,{show:M.value},{default:n(()=>[h.value.length===0&&v.value&&!M.value?(a(),f("div",Re,[e(q,{description:"没有找到匹配的结果"})])):h.value.length===0&&!v.value?(a(),f("div",Fe,[e(N,{depth:"3"},{default:n(()=>[...m[4]||(m[4]=[b("输入关键字开始搜索",-1)])]),_:1})])):(a(),P(r,{key:2,hoverable:"",clickable:""},{default:n(()=>[(a(!0),f(pe,null,we(h.value,c=>(a(),P(D,{key:`${c.type}-${c.id}`,onClick:$=>T(c)},{prefix:n(()=>[e(j,{color:p(c.type),size:"20"},{default:n(()=>[(a(),P(me(L(c.type))))]),_:2},1032,["color"])]),default:n(()=>[e(A,{title:c.name,description:c.desc},{"header-extra":n(()=>[e(G,{type:S(c.type),size:"small"},{default:n(()=>[b(E(z(c.type)),1)]),_:2},1032,["type"])]),_:2},1032,["title","description"])]),_:2},1032,["onClick"]))),128))]),_:1}))]),_:1},8,["show"])])]),_:1},8,["show"])])}}}),We=re(Qe,[["__scopeId","data-v-7d2b7e9a"]]),Xe={class:"logo"},Ye={key:0},Ze={key:1},Je={class:"header-title"},et={class:"header-actions"},tt=y({__name:"Layout",setup(g){const i=je(),o=oe(),v=ke(),h=he(),M=_e(),C=k(!1),_=k(!1),O=k(!1),T=k(!1),L=k(!1),z=k({site_name:"GOST Panel",favicon_url:"/vite.svg",logo_url:"",footer_text:""}),p=k({old_password:"",new_password:"",confirm_password:""}),S=k({email:""}),u=r=>()=>Y(J,null,{default:()=>Y(r)}),l=[{label:"仪表盘",key:"dashboard",icon:u(Te)},{label:"客户端",key:"clients",icon:u(le)},{label:"节点管理",key:"nodes",icon:u(H)},{label:"端口转发",key:"port-forwards",icon:u(be)},{label:"负载均衡",key:"node-groups",icon:u(Me)},{label:"隧道转发",key:"tunnels",icon:u(Oe)},{label:"用户管理",key:"users",icon:u(Se)},{label:"告警通知",key:"notify",icon:u($e)},{label:"操作日志",key:"operation-logs",icon:u(Ue)},{label:"网站设置",key:"settings",icon:u(ee)}],m=[{label:"账户设置",key:"account-settings",icon:u(ee)},{label:"修改密码",key:"change-password",icon:u(ze)},{label:"退出登录",key:"logout",icon:u(Ne)}],j=X(()=>v.name),I=X(()=>l.find(t=>t.key===j.value)?.label||"仪表盘"),V=r=>{o.push({name:r})},q=async r=>{r==="logout"?(h.logout(),o.push("/login")):r==="change-password"?(p.value={old_password:"",new_password:"",confirm_password:""},_.value=!0):r==="account-settings"&&(await N(),O.value=!0)},N=async()=>{try{const r=await ge();S.value={email:r.email||""}}catch{i.error("加载用户信息失败")}},G=async()=>{L.value=!0;try{await xe({email:S.value.email}),i.success("账户信息已更新"),O.value=!1}catch(r){i.error(r.response?.data?.error||"保存失败")}finally{L.value=!1}},A=async()=>{if(p.value.new_password!==p.value.confirm_password){i.error("两次输入的密码不一致");return}T.value=!0;try{await Ce(p.value.old_password,p.value.new_password),i.success("密码修改成功"),_.value=!1,p.value={old_password:"",new_password:"",confirm_password:""}}catch(r){i.error(r.response?.data?.error||"密码修改失败")}finally{T.value=!1}},D=async()=>{try{const r=await ye();if(z.value=r,r.site_name&&(document.title=r.site_name),r.favicon_url){let t=document.querySelector('link[rel="icon"]');t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=r.favicon_url}if(r.custom_css){let t=document.getElementById("custom-css");t||(t=document.createElement("style"),t.id="custom-css",document.head.appendChild(t)),t.textContent=r.custom_css}}catch{}};return ne(()=>{D()}),(r,t)=>{const K=s("n-menu"),c=s("n-layout-sider"),$=s("n-button"),se=s("n-dropdown"),ae=s("n-layout-header"),ie=s("router-view"),ue=s("n-layout-content"),R=s("n-layout"),B=s("n-input"),U=s("n-form-item"),F=s("n-form"),Q=s("n-space"),W=s("n-modal");return a(),P(R,{"has-sider":"",class:"layout"},{default:n(()=>[e(c,{bordered:"","collapse-mode":"width","collapsed-width":64,width:200,"show-trigger":"",collapsed:C.value,onCollapse:t[0]||(t[0]=w=>C.value=!0),onExpand:t[1]||(t[1]=w=>C.value=!1)},{default:n(()=>[d("div",Xe,[C.value?(a(),f("span",Ze,E((z.value.site_name||"G")[0]),1)):(a(),f("span",Ye,E(z.value.site_name||"GOST Panel"),1))]),e(K,{collapsed:C.value,"collapsed-width":64,"collapsed-icon-size":22,options:l,value:j.value,"onUpdate:value":V},null,8,["collapsed","value"])]),_:1},8,["collapsed"]),e(R,null,{default:n(()=>[e(ae,{bordered:"",class:"header"},{default:n(()=>[d("div",Je,E(I.value),1),d("div",et,[e(We),e($,{quaternary:"",circle:"",onClick:x(M).toggle},{icon:n(()=>[e(x(J),null,{default:n(()=>[x(M).isDark?(a(),P(x(Ke),{key:1})):(a(),P(x(Ve),{key:0}))]),_:1})]),_:1},8,["onClick"]),e(se,{options:m,onSelect:q},{default:n(()=>[e($,{quaternary:""},{default:n(()=>[b(E(x(h).user?.username||"admin"),1)]),_:1})]),_:1})])]),_:1}),e(ue,{class:"content"},{default:n(()=>[e(ie)]),_:1})]),_:1}),e(W,{show:_.value,"onUpdate:show":t[6]||(t[6]=w=>_.value=w),preset:"dialog",title:"修改密码"},{action:n(()=>[e(Q,null,{default:n(()=>[e($,{onClick:t[5]||(t[5]=w=>_.value=!1)},{default:n(()=>[...t[10]||(t[10]=[b("取消",-1)])]),_:1}),e($,{type:"primary",loading:T.value,onClick:A},{default:n(()=>[...t[11]||(t[11]=[b("确定",-1)])]),_:1},8,["loading"])]),_:1})]),default:n(()=>[e(F,{model:p.value,"label-placement":"left","label-width":"100"},{default:n(()=>[e(U,{label:"当前密码"},{default:n(()=>[e(B,{value:p.value.old_password,"onUpdate:value":t[2]||(t[2]=w=>p.value.old_password=w),type:"password",placeholder:"请输入当前密码"},null,8,["value"])]),_:1}),e(U,{label:"新密码"},{default:n(()=>[e(B,{value:p.value.new_password,"onUpdate:value":t[3]||(t[3]=w=>p.value.new_password=w),type:"password",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),e(U,{label:"确认密码"},{default:n(()=>[e(B,{value:p.value.confirm_password,"onUpdate:value":t[4]||(t[4]=w=>p.value.confirm_password=w),type:"password",placeholder:"请再次输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(W,{show:O.value,"onUpdate:show":t[9]||(t[9]=w=>O.value=w),preset:"dialog",title:"账户设置",style:{width:"500px"}},{action:n(()=>[e(Q,null,{default:n(()=>[e($,{onClick:t[8]||(t[8]=w=>O.value=!1)},{default:n(()=>[...t[12]||(t[12]=[b("取消",-1)])]),_:1}),e($,{type:"primary",loading:L.value,onClick:G},{default:n(()=>[...t[13]||(t[13]=[b("保存",-1)])]),_:1},8,["loading"])]),_:1})]),default:n(()=>[e(F,{model:S.value,"label-placement":"left","label-width":"100"},{default:n(()=>[e(U,{label:"用户名"},{default:n(()=>[e(B,{value:x(h).user?.username,disabled:""},null,8,["value"])]),_:1}),e(U,{label:"邮箱"},{default:n(()=>[e(B,{value:S.value.email,"onUpdate:value":t[7]||(t[7]=w=>S.value.email=w),placeholder:"user@example.com"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1})}}}),ct=re(tt,[["__scopeId","data-v-9cebd248"]]);export{ct as default};
